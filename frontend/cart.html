<!DOCTYPE html>
<html>

<head>
  <title>Shopping Cart</title>
  <link rel="stylesheet" href="./style/nav.css">
  <link rel="stylesheet" href="./style/footer.css">
  <link rel="stylesheet" href="./style/cart.css">
  <script src="https://kit.fontawesome.com/a076d05399.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body onload="fetchValues()">

  <header>
    <!-- Add the header content, such as the logo and search bar -->
    <div id="snackbar">Product deleted from cart..</div>
    <nav class="navbar">

      <div class="nav-searchbar">
        <div id="logo">
          <img src="https://github.com/Pujansharma/Brookstone/assets/113420172/203ef402-8d3c-4679-aa69-e1a5b1985511"
            id="logo-image">
        </div>
        <div class="search">
          <input type="text" id="search-input" placeholder="Search">

        </div>
        <div class="icon-search">
          <!-- <img src="" > -->
          <img id="search-icon" src="https://cdn-icons-png.flaticon.com/512/482/482631.png" alt="searchicon">
        </div>
        <div class="cart-login">
          <img
            src="https://github.com/Pujansharma/Assignment_test/assets/113420172/3e633f53-b076-4108-9733-1bde9ddf7f9b"
            alt="" id="user-logout">
          <img src="https://cdn.iconscout.com/icon/premium/png-512-thumb/add-user-2513329-2104653.png?f=avif&w=256"
            id="user-icon">
          <img src="https://cdn.iconscout.com/icon/premium/png-512-thumb/love-1419433-1198271.png?f=avif&w=256"
            id="favorite-icon">
          <img src="https://cdn.iconscout.com/icon/free/png-512/cart-3731224-3112098.png?f=avif&w=256" id="cart-icon">
        </div>
      </div>


    </nav>

    <!-- *****************************************DROP-DOWNS-CONTAINERS************************************************* -->
    <!-- ///////////Massage//////////////// -->




  </header>
  <main id="main_item_container">
    <section class="cart">
      <h1>Your Cart</h1>
      <table>
        <thead>
          <tr>
            <th>Item</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <!-- Add the table rows for each item in the cart -->
        </tbody>
      </table>
      <div class="cart-total">
        <p>Total Amount</p>
        <span id="grandtotal">$0.00</span>
      </div>
      <button class="checkout-btn">Checkout</button>
    </section>
  </main>



  </div>
  <footer class="padding_4x" style="margin-top: 20px;">
    <div class="flex">
      <section class="flex-content padding_1x">
        <h3>About</h3>
        <a href="#" style="color: white;">Zoom Blog</a>
        <a href="#" style="color: white;">Customers</a>
        <a href="#" style="color: white;">Our Team</a>
        <a href="#" style="color: white;">Careers</a>
        <a href="#" style="color: white;">Integrations</a>

      </section>
      <section class="flex-content padding_1x">
        <h3>Download</h3>
        <a href="#" style="color: white;">Meetings Client</a>
        <a href="#" style="color: white;">Zoom Rooms Client</a>
        <a href="#" style="color: white;">Zoom Rooms Controller</a>
        <a href="#" style="color: white;">Browser Extension</a>
        <a href="#" style="color: white;">Outlook Plug-in</a>
      </section>
      <section class="flex-content padding_1x">
        <h3>Sales
        </h3>
        <a href="#" style="color: white;">1.888.799.9666</a>
        <a href="#" style="color: white;">Contact Sales</a>
        <a href="#" style="color: white;">Plans & Pricing</a>
        <a href="#" style="color: white;">Request a Demo</a>
        <a href="#" style="color: white;">Webinars and Events</a>
      </section>
      <section class="flex-content padding_1x">
        <h3>Support
        </h3>
        <a href="#" style="color: white;">Test Talkies</a>
        <a href="#" style="color: white;">Account</a>
        <a href="#" style="color: white;">Support Center</a>
        <a href="#" style="color: white;">Learning Center</a>
        <a href="#" style="color: white;">Feedback</a>
        <a href="#" style="color: white;">Contact Us</a>
      </section>
      <section class="flex-content padding_1x">
        <h3 style="color: white;">Newsletter</h3>
        <p style="color: white;">You can trust us. we only send promo offers,</p>
        <fieldset class="fixed_flex">


        </fieldset>
      </section>

    </div>
    <div class="flex">
      <section class="flex-content padding_1x">
        <p>Copyright Â©2023 All rights reserved || Talkies - Let's connect</p>
      </section>
      <section class="flex-content padding_1x">
        <a href="https://www.facebook.com/zoom"><i class="fa fa-facebook"></i></a>
        <a href="https://twitter.com/zoom"><i class="fa fa-twitter"></i></a>
        <a href="https://www.instagram.com/zoom/"><i class="fa fa-dribbble"></i></a>
        <a href="https://www.linkedin.com/company/zoom-video-communications/"><i class="fa fa-linkedin"></i></a>
      </section>
    </div>
  </footer>
  <script>
    function fetchValues() {
      if (JSON.parse(localStorage.getItem("qty")) > 0) {
        {
          document.querySelector(".checkout-btn").style.visibility = "hidden";
        }
        document.getElementById("item").style.visibility = "visible";


      }
      var user = JSON.parse(localStorage.getItem("user"));
      document.getElementById("username").textContent = user.username;
    }
  </script>
  <!-- <script src="./script/cart.js"></script> -->
</body>
<script>

  // checkout-btn
  let logo = document.querySelector("#logo-image");
  logo.addEventListener("click", () => {
    window.location.href = "./index.html"
  })
  let checkout = document.querySelector(".checkout-btn");
  checkout.addEventListener("click", () => {
    Swal.fire(
      'Order placed',
      'Successful',
      'success'
    )
    setTimeout(() => {
      window.location.href = ("./index.html")
    }, 3000);
  })

  let userslogo = document.querySelector("#user-icon")
  userslogo.addEventListener("click", () => {
    let tokendata = localStorage.getItem("token")
    console.log(tokendata)

    window.location.href = "./login.html"


  })
  let cartlogo = document.querySelector("#cart-icon")
  cartlogo.addEventListener("click", () => {
    let tokendata = localStorage.getItem("token")
    if (tokendata) {
      window.location.href = "./cart.html"
    } else {
      window.location.href = "./login.html"
    }

  })



  let cartItems = JSON.parse(localStorage.getItem("Favourites")) || [];
  console.log(cartItems)
  const tableBody = document.querySelector('tbody');
  let quantity = 1
  cartItems.forEach(item => {

    const row = document.createElement('tr');

    row.innerHTML = `
		<td>
			<img id="img" src="${item.image}" alt="${item.name}">
			${item.name}
		</td>
		<td>$${item.price}</td>
<td>
  
<button class="decrease-quantity" data-name="${item.name}">-</button>
<span class="quantity">${quantity}</span>
<button class="increase-quantity" data-name="${item.name}">+</button>
</td>
<td>$${(item.price * quantity)}</td>
<td>
<button class="remove-item" data-name="${item.name}">Remove</button>
</td>
`;
    tableBody.appendChild(row);
  });

  const decreaseButtons = document.querySelectorAll('.decrease-quantity');
  const increaseButtons = document.querySelectorAll('.increase-quantity');
  const removeButtons = document.querySelectorAll('.remove-item');

  function decreaseQuantity(event) {
    const button = event.target;
    const itemName = button.dataset.name;
    const itemRow = button.parentNode.parentNode;
    const itemQuantity = itemRow.querySelector('.quantity');
    const itemPrice = itemRow.querySelector('td:nth-child(2)');
    const itemTotal = itemRow.querySelector('td:nth-child(4)');
    let quantity = parseInt(itemQuantity.textContent);
    if (quantity > 1) {
      quantity--;
      itemQuantity.textContent = quantity;
      itemTotal.textContent = (quantity * parseFloat(itemPrice.textContent.substring(1))).toFixed(2);
      updateCartTotal();
    }
  }

  function increaseQuantity(event) {
    const button = event.target;
    const itemName = button.dataset.name;
    const itemRow = button.parentNode.parentNode;
    const itemQuantity = itemRow.querySelector('.quantity');
    const itemPrice = itemRow.querySelector('td:nth-child(2)');
    const itemTotal = itemRow.querySelector('td:nth-child(4)');
    let quantity = parseInt(itemQuantity.textContent);
    quantity++;
    itemQuantity.textContent = quantity;
    itemTotal.textContent = (quantity * parseFloat(itemPrice.textContent.substring(1))).toFixed(2);
    updateCartTotal();
    // console.log(quantity)
    console.log(itemQuantity.value)
  }

  function removeItem(event) {
    const button = event.target;
    const itemName = button.dataset.name;
    const itemRow = button.parentNode.parentNode;
    var x = document.getElementById("snackbar");
    x.className = "show";
    setTimeout(function () { x.className = x.className.replace("show", ""); }, 3000);

    // Remove the item from the display
    itemRow.remove();

    // Update local storage
    const cartItems = JSON.parse(localStorage.getItem('Favourites')) || [];
    const updatedCartItems = cartItems.filter(item => item.name !== itemName);
    localStorage.setItem('Favourites', JSON.stringify(updatedCartItems));

    updateCartTotal();
  }

  function updateCartTotal() {
    const cartRows = document.querySelectorAll('tbody tr');
    let total = 0;
    cartRows.forEach(row => {
      const priceElement = row.querySelector('td:nth-child(2)');
      const quantityElement = row.querySelector('.quantity');
      const price = parseFloat(priceElement.textContent.substring(1));
      const quantity = parseInt(quantityElement.textContent);
      total += price * quantity

    });
    console.log(total)
    let grandtotal = document.querySelector("#grandtotal");
    grandtotal.textContent = `â¹ ${+total.toFixed(3)}`;
    let totaldat = +total.toFixed(3)
    localStorage.setItem("grandtotal", totaldat)
  }

  decreaseButtons.forEach(button => {
    button.addEventListener('click', decreaseQuantity);
  });

  increaseButtons.forEach(button => {
    button.addEventListener('click', increaseQuantity);
  });

  removeButtons.forEach(button => {
    button.addEventListener('click', removeItem);

  });

  updateCartTotal();
  let tokendata = localStorage.getItem("token");
  let userIcon = document.querySelector("#user-icon");
  let userLogout = document.querySelector("#user-logout");
  if (tokendata) {
    userIcon.style.display = "none";
    userLogout.style.display = "block";
  } else {
    // userIcon.style.display = "none";
    userLogout.style.display = "block";
  }
  userLogout.addEventListener("click", () => {
    localStorage.removeItem("token");
    window.location.href = "./index.html";
  });


</script>

</html>